
1.[feature_importance.py]
2.[Radscore_Log-rank.py] / [Radscore_Youden.py]  ：基于选择的模型用cox計算放射組學評分來分組
3.[Kaplan-Meier_Rad_train.py]： 放射組學km預覽，不是真正的模型
[Radscore_Cox.py] 用cox模型计算放射组学评分


===========
高低危险分层的可视化，特别是使用Kaplan-Meier (KM) 生存曲线进行的可视化，通常首先在训练数据集上进行，以确定模型和分层方法的有效性。然而，为了验证模型的泛化能力和分层方法的稳健性，也非常重要地在独立的验证数据集和测试数据集上进行这种可视化。

训练数据集：在训练数据集上进行KM图形的可视化主要用于模型开发阶段，以评估不同风险分组（高危vs低危）之间的生存差异是否显著。这有助于在模型调整和风险分层方法确定过程中提供直观的反馈。

验证数据集：在独立的验证集上进行KM图形的可视化是检验模型在未见数据上表现的重要步骤。通过在验证集上评估高低风险组的生存差异，可以进一步验证分层方法的有效性和模型的泛化能力。

测试数据集：最后，在独立的测试数据集上进行KM图形的可视化是最终确认模型泛化能力和风险分层有效性的关键步骤。理想情况下，模型应该能够在测试集上重现在训练集和验证集中观察到的相似生存差异。

在学术研究和临床研究报告中，通常会展示训练集、验证集和测试集上的KM生存曲线，以全面展示模型的性能和风险分层的有效性。通过这种方式，研究者可以向读者展示模型在不同数据集上的一致性和可靠性，增强研究结果的信服力。

新建训练、验证、测试集

```angular2html
使用生存分析方法确定最佳阈值的意义
生存数据的特性：生存数据通常包括时间到事件（如复发、死亡）的信息和是否观察到事件的指示（即右侧删失）。生存分析方法考虑了这些数据的特性，能够有效处理删失数据，提供对时间到事件数据的深入理解。

评估风险分组的有效性：通过生存分析，如Kaplan-Meier生存曲线和对数秩检验，可以直观地评估不同风险组之间生存时间的差异。这有助于验证将患者基于某个阈值分为高低风险组的有效性。

确定最佳阈值：生存分析方法可以用来确定将患者分为高低风险组的最佳RadSCORE阈值。这个阈值是基于生存时间差异最大化的原则选出的，从而确保高低风险组的划分在统计学上有显著差异，对临床决策有实际意义。

分类模型在这里的意义
个体化风险评估：分类模型通过学习影像特征与生存结果之间的关系，可以为每个患者提供个体化的风险评分（RadSCORE）。这种方法比传统的基于单一或少数生物标志物的风险评估更为精细和全面。

提高预测准确性：利用机器学习模型，尤其是像LightGBM这样的高效算法，可以处理高维数据，捕捉复杂的非线性关系，从而提高对患者预后的预测准确性。

辅助临床决策：通过将患者基于预测的RadSCORE分为不同的风险组，医生可以根据患者的风险等级制定个性化的治疗计划，如决定是否采用更积极的治疗策略。

综上所述，结合使用分类模型和生存分析方法，可以在保持预测准确性的同时，提供一种基于数据驱动的方法来确定将患者分为高低风险组的最佳阈值。这种方法不仅考虑了生存数据的特性，而且能够根据患者的具体特征提供个性化的风险评估，对于指导临床决策具有重要意义。
```
```angular2html
使用生存分析确定最佳阈值的过程。这个过程的核心思想是通过迭代尝试不同的阈值来分割数据集，然后使用生存分析的方法（如对数秩检验）来评估每个阈值下分割后的两组数据在生存时间上的差异。目标是找到一个阈值，使得基于该阈值分割的两组（高风险组和低风险组）在生存时间上有最大的统计学差异。这个过程可以分为以下几个步骤：

步骤 1: 定义阈值范围
首先，你需要定义尝试的阈值范围。这通常基于你的RadSCORE的分布。例如，如果RadSCORE的范围是从0到1，你可以在这个范围内均匀地选择一系列的阈值进行尝试。

步骤 2: 迭代尝试不同的阈值
对于每一个选定的阈值，你将使用它来将数据集分为两组：一组的RadSCORE高于阈值（高风险组），另一组的RadSCORE低于或等于阈值（低风险组）。

步骤 3: 对每个阈值进行生存分析
对于每个阈值定义的两组数据，使用生存分析的方法来评估它们在生存时间上的差异。常用的方法是对数秩检验（Log-rank Test），它是比较两个生存曲线差异的标准方法。对数秩检验的p值可以用来衡量两组生存时间差异的显著性。

步骤 4: 选择最佳阈值
迭代完成后，选择使得两组生存时间差异最大（即对数秩检验的p值最小）的阈值作为最佳阈值。这个阈值将用于将患者分为高风险和低风险两组.
```
----------------------
```angular2html
Cox回归模型，也称为比例风险模型，是一种用于生存分析的统计方法，用于研究某些因素（协变量）如何影响事件发生（例如，死亡、故障等）的时间。
在使用Cox回归模型时，确实有一些参数可以调整，而且模型的建立过程也可以通过不同的方式进行可视化。以下是一些关键点：

Cox回归模型的调参
比例风险假设：Cox模型基于一个重要的假设，即不同个体的风险比是恒定的（比例风险假设）。在实践中，这个假设需要通过残差分析等方法进行检验。

变量选择：在建立模型时，选择哪些变量（协变量）纳入模型是一个重要的决策。可以通过前向选择、后向消除或逐步回归等方法来选择变量。

正则化：在某些情况下，为了防止过拟合，可以考虑使用L1（Lasso）或L2（Ridge）正则化。这在使用较为复杂的数据集或在高维数据情况下尤其有用。

Cox回归模型的可视化
风险比（Hazard Ratio）：可以将模型中每个变量的风险比（及其置信区间）绘制成森林图，这有助于直观地展示每个变量对生存时间的影响。

生存曲线：可以根据模型中的协变量值绘制调整后的生存曲线，以展示不同组的生存概率。

残差分析：可以通过绘制残差图来检验比例风险假设，例如Schoenfeld残差图。

保存单变量还是多变量Cox模型
单变量Cox回归：单变量分析用于评估单个变量与生存时间的关系。这可以作为变量选择的初步步骤，帮助识别可能与结果相关的变量。

多变量Cox回归：在单变量分析的基础上，多变量Cox回归考虑了多个变量的联合效应，可以用来调整混杂因素，得到每个变量在控制了其他变量后对生存时间的影响。

在实际应用中，通常会先进行单变量分析来筛选变量，然后在多变量模型中进一步分析这些变量的效应。最终，保存和解释的是多变量Cox回归模型，因为它提供了在考虑其他相关因素影响的情况下，每个协变量对生存时间影响的更准确估计。
```

